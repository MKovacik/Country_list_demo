<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countries of the World</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            font-size: 2em;
        }

        .table-container {
            overflow-x: auto;
            padding: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        thead {
            background-color: #f8f9fa;
        }

        th {
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            cursor: pointer;
            user-select: none;
            position: relative;
        }

        th:hover {
            background-color: #e9ecef;
        }

        th.sortable::after {
            content: ' ‚áÖ';
            color: #adb5bd;
            font-size: 0.8em;
        }

        th.sort-asc::after {
            content: ' ‚Üë';
            color: #667eea;
        }

        th.sort-desc::after {
            content: ' ‚Üì';
            color: #667eea;
        }

        td {
            padding: 12px 10px;
            border-bottom: 1px solid #e9ecef;
        }

        tbody tr:hover {
            background-color: #f8f9fa;
        }

        .flag-img {
            width: 40px;
            height: 30px;
            object-fit: cover;
            border: 1px solid #dee2e6;
            border-radius: 2px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #6c757d;
        }

        .error {
            text-align: center;
            padding: 40px;
            color: #dc3545;
            font-size: 1.1em;
        }

        .stats {
            padding: 20px 30px;
            background-color: #f8f9fa;
            border-top: 1px solid #dee2e6;
            font-size: 0.9em;
            color: #6c757d;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 1.5em;
                padding: 20px;
            }

            .table-container {
                padding: 10px;
            }

            th, td {
                padding: 8px 5px;
                font-size: 0.9em;
            }

            .flag-img {
                width: 30px;
                height: 22px;
            }

            .stats {
                padding: 15px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåç Countries of the World</h1>
        <div id="content">
            <div class="loading">Loading countries data...</div>
        </div>
        <div class="stats" id="stats" style="display: none;"></div>
    </div>

    <script>
        let countriesData = [];
        let currentSort = { column: null, direction: 'asc' };

        // Load and display countries data
        async function loadCountries() {
            try {
                const response = await fetch('countries.json');
                if (!response.ok) {
                    throw new Error('Failed to load countries data');
                }
                countriesData = await response.json();
                displayCountries(countriesData);
                updateStats(countriesData);
            } catch (error) {
                document.getElementById('content').innerHTML = 
                    `<div class="error">Error loading countries data: ${error.message}</div>`;
            }
        }

        // Format languages from object to comma-separated string
        function formatLanguages(languages) {
            if (!languages) return 'N/A';
            return Object.values(languages).join(', ');
        }

        // Format number with thousands separator
        function formatNumber(num) {
            if (!num && num !== 0) return 'N/A';
            return num.toLocaleString();
        }

        // Display countries in table
        function displayCountries(countries) {
            const content = document.getElementById('content');
            
            const tableHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Flag</th>
                                <th class="sortable" onclick="sortTable('name')">Country Name</th>
                                <th class="sortable" onclick="sortTable('region')">Region</th>
                                <th class="sortable" onclick="sortTable('capital')">Capital</th>
                                <th class="sortable" onclick="sortTable('languages')">Languages</th>
                                <th class="sortable" onclick="sortTable('population')">Population</th>
                                <th class="sortable" onclick="sortTable('area')">Area (km¬≤)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${countries.map(country => `
                                <tr>
                                    <td>
                                        <img src="${country.flags?.png || ''}" 
                                             alt="${country.name?.common || 'Flag'}" 
                                             class="flag-img"
                                             onerror="this.style.display='none'">
                                    </td>
                                    <td>${country.name?.common || 'N/A'}</td>
                                    <td>${country.region || 'N/A'}</td>
                                    <td>${country.capital?.[0] || 'N/A'}</td>
                                    <td>${formatLanguages(country.languages)}</td>
                                    <td>${formatNumber(country.population)}</td>
                                    <td>${formatNumber(country.area)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            content.innerHTML = tableHTML;
        }

        // Sort table by column
        function sortTable(column) {
            // Determine sort direction
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }

            // Sort the data
            const sortedData = [...countriesData].sort((a, b) => {
                let aVal, bVal;

                switch (column) {
                    case 'name':
                        aVal = a.name?.common || '';
                        bVal = b.name?.common || '';
                        break;
                    case 'region':
                        aVal = a.region || '';
                        bVal = b.region || '';
                        break;
                    case 'capital':
                        aVal = a.capital?.[0] || '';
                        bVal = b.capital?.[0] || '';
                        break;
                    case 'languages':
                        aVal = formatLanguages(a.languages);
                        bVal = formatLanguages(b.languages);
                        break;
                    case 'population':
                        aVal = a.population || 0;
                        bVal = b.population || 0;
                        return currentSort.direction === 'asc' ? aVal - bVal : bVal - aVal;
                    case 'area':
                        aVal = a.area || 0;
                        bVal = b.area || 0;
                        return currentSort.direction === 'asc' ? aVal - bVal : bVal - aVal;
                    default:
                        return 0;
                }

                // String comparison
                // Ensure values are strings for localeCompare
                const aStr = String(aVal);
                const bStr = String(bVal);
                if (currentSort.direction === 'asc') {
                    return aStr.localeCompare(bStr);
                } else {
                    return bStr.localeCompare(aStr);
                }
            });

            // Update the display
            displayCountries(sortedData);
            updateSortIndicators();
        }

        // Update sort indicators in column headers
        function updateSortIndicators() {
            const headers = document.querySelectorAll('th.sortable');
            headers.forEach(header => {
                header.classList.remove('sort-asc', 'sort-desc');
            });

            const columnNames = ['name', 'region', 'capital', 'languages', 'population', 'area'];
            const currentIndex = columnNames.indexOf(currentSort.column);
            
            if (currentIndex !== -1) {
                const currentHeader = headers[currentIndex];
                if (currentSort.direction === 'asc') {
                    currentHeader.classList.add('sort-asc');
                } else {
                    currentHeader.classList.add('sort-desc');
                }
            }
        }

        // Update statistics
        function updateStats(countries) {
            const totalPopulation = countries.reduce((sum, country) => sum + (country.population || 0), 0);
            const totalArea = countries.reduce((sum, country) => sum + (country.area || 0), 0);
            
            document.getElementById('stats').innerHTML = `
                <strong>Total Countries:</strong> ${countries.length} | 
                <strong>Total Population:</strong> ${formatNumber(totalPopulation)} | 
                <strong>Total Area:</strong> ${formatNumber(Math.round(totalArea))} km¬≤
            `;
            document.getElementById('stats').style.display = 'block';
        }

        // Load countries on page load
        loadCountries();
    </script>
</body>
</html>
