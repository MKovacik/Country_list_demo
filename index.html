<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countries of the World</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            font-size: 2em;
        }

        .table-container {
            overflow-x: auto;
            padding: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        thead {
            background-color: #f8f9fa;
        }

        th {
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            cursor: pointer;
            user-select: none;
            position: relative;
        }

        th:hover {
            background-color: #e9ecef;
        }

        th.sortable::after {
            content: ' ‚áÖ';
            color: #adb5bd;
            font-size: 0.8em;
        }

        th.sort-asc::after {
            content: ' ‚Üë';
            color: #667eea;
        }

        th.sort-desc::after {
            content: ' ‚Üì';
            color: #667eea;
        }

        td {
            padding: 12px 10px;
            border-bottom: 1px solid #e9ecef;
        }

        tbody tr:hover {
            background-color: #f8f9fa;
        }

        .flag-img {
            width: 40px;
            height: 30px;
            object-fit: cover;
            border: 1px solid #dee2e6;
            border-radius: 2px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #6c757d;
        }

        .error {
            text-align: center;
            padding: 40px;
            color: #dc3545;
            font-size: 1.1em;
        }

        .stats {
            padding: 20px 30px;
            background-color: #f8f9fa;
            border-top: 1px solid #dee2e6;
            font-size: 0.9em;
            color: #6c757d;
        }

        .controls {
            padding: 20px 30px;
            background-color: #ffffff;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 1em;
            transition: border-color 0.2s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-box {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-box label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
        }

        .filter-box select {
            padding: 10px 15px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 1em;
            background-color: white;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .filter-box select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .active-filters {
            padding: 0 30px 15px;
            font-size: 0.9em;
            color: #6c757d;
        }

        .filter-tag {
            display: inline-block;
            background-color: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            margin-right: 8px;
            font-size: 0.85em;
        }

        .filter-tag .close {
            margin-left: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .filter-tag .close:hover {
            color: #f8f9fa;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-size: 1.1em;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 1.5em;
                padding: 20px;
            }

            .controls {
                padding: 15px;
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                min-width: 100%;
            }

            .filter-box {
                flex-direction: column;
                align-items: stretch;
                gap: 5px;
            }

            .filter-box select {
                width: 100%;
            }

            .table-container {
                padding: 10px;
            }

            th, td {
                padding: 8px 5px;
                font-size: 0.9em;
            }

            .flag-img {
                width: 30px;
                height: 22px;
            }

            .stats {
                padding: 15px;
                font-size: 0.8em;
            }

            .active-filters {
                padding: 0 15px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåç Countries of the World</h1>
        <div class="controls">
            <div class="search-box">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="üîç Search countries by name..." 
                    aria-label="Search countries"
                >
            </div>
            <div class="filter-box">
                <label for="regionFilter">Region:</label>
                <select id="regionFilter" aria-label="Filter by region">
                    <option value="">All Regions</option>
                </select>
            </div>
        </div>
        <div class="active-filters" id="activeFilters" style="display: none;"></div>
        <div id="content">
            <div class="loading">Loading countries data...</div>
        </div>
        <div class="stats" id="stats" style="display: none;"></div>
    </div>

    <script>
        let countriesData = [];
        let filteredData = [];
        let currentSort = { column: null, direction: 'asc' };
        let currentFilters = { search: '', region: '' };

        // Load and display countries data
        async function loadCountries() {
            try {
                const response = await fetch('countries.json');
                if (!response.ok) {
                    throw new Error('Failed to load countries data');
                }
                countriesData = await response.json();
                filteredData = countriesData;
                populateRegionFilter();
                displayCountries(filteredData);
                updateStats(filteredData);
                setupEventListeners();
            } catch (error) {
                document.getElementById('content').innerHTML = 
                    `<div class="error">Error loading countries data: ${error.message}</div>`;
            }
        }

        // Populate region filter dropdown with unique regions
        function populateRegionFilter() {
            const regions = [...new Set(countriesData.map(c => c.region).filter(Boolean))].sort();
            const select = document.getElementById('regionFilter');
            regions.forEach(region => {
                const option = document.createElement('option');
                option.value = region;
                option.textContent = region;
                select.appendChild(option);
            });
        }

        // Setup event listeners for search and filter
        function setupEventListeners() {
            const searchInput = document.getElementById('searchInput');
            const regionFilter = document.getElementById('regionFilter');

            // Search with debounce for performance
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    currentFilters.search = e.target.value.toLowerCase().trim();
                    applyFilters();
                }, 300);
            });

            // Region filter
            regionFilter.addEventListener('change', (e) => {
                currentFilters.region = e.target.value;
                applyFilters();
            });
        }

        // Apply all filters and update display
        function applyFilters() {
            filteredData = countriesData.filter(country => {
                const nameMatch = !currentFilters.search || 
                    (country.name?.common || '').toLowerCase().includes(currentFilters.search);
                const regionMatch = !currentFilters.region || 
                    country.region === currentFilters.region;
                
                return nameMatch && regionMatch;
            });

            // Reapply current sort if any
            if (currentSort.column) {
                const sortedData = sortData(filteredData, currentSort.column, currentSort.direction);
                displayCountries(sortedData);
            } else {
                displayCountries(filteredData);
            }
            
            updateStats(filteredData);
            updateActiveFilters();
        }

        // Update active filters display
        function updateActiveFilters() {
            const activeFiltersDiv = document.getElementById('activeFilters');
            
            // Clear existing content
            activeFiltersDiv.innerHTML = '';

            const filterTypes = [];
            if (currentFilters.search) {
                filterTypes.push({ type: 'search', label: `Search: "${currentFilters.search}"` });
            }
            if (currentFilters.region) {
                filterTypes.push({ type: 'region', label: `Region: ${currentFilters.region}` });
            }

            if (filterTypes.length > 0) {
                const span = document.createElement('span');
                span.textContent = 'Active filters: ';
                activeFiltersDiv.appendChild(span);

                filterTypes.forEach(filter => {
                    const tag = document.createElement('span');
                    tag.className = 'filter-tag';
                    tag.textContent = filter.label + ' ';
                    
                    const closeBtn = document.createElement('span');
                    closeBtn.className = 'close';
                    closeBtn.textContent = '√ó';
                    closeBtn.onclick = () => clearFilter(filter.type);
                    
                    tag.appendChild(closeBtn);
                    activeFiltersDiv.appendChild(tag);
                });

                activeFiltersDiv.style.display = 'block';
            } else {
                activeFiltersDiv.style.display = 'none';
            }
        }

        // Clear specific filter
        function clearFilter(type) {
            if (type === 'search') {
                currentFilters.search = '';
                document.getElementById('searchInput').value = '';
            } else if (type === 'region') {
                currentFilters.region = '';
                document.getElementById('regionFilter').value = '';
            }
            applyFilters();
        }

        // Format languages from object to comma-separated string
        function formatLanguages(languages) {
            if (!languages) return 'N/A';
            return Object.values(languages).join(', ');
        }

        // Format number with thousands separator
        function formatNumber(num) {
            if (!num && num !== 0) return 'N/A';
            return num.toLocaleString();
        }

        // Display countries in table
        function displayCountries(countries) {
            const content = document.getElementById('content');
            
            if (countries.length === 0) {
                content.innerHTML = '<div class="no-results">No countries found matching your criteria. Try adjusting your search or filters.</div>';
                return;
            }

            const tableHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Flag</th>
                                <th class="sortable" onclick="sortTable('name')">Country Name</th>
                                <th class="sortable" onclick="sortTable('region')">Region</th>
                                <th class="sortable" onclick="sortTable('capital')">Capital</th>
                                <th class="sortable" onclick="sortTable('languages')">Languages</th>
                                <th class="sortable" onclick="sortTable('population')">Population</th>
                                <th class="sortable" onclick="sortTable('area')">Area (km¬≤)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${countries.map(country => `
                                <tr>
                                    <td>
                                        <img src="${country.flags?.png || ''}" 
                                             alt="${country.name?.common || 'Flag'}" 
                                             class="flag-img"
                                             onerror="this.style.display='none'">
                                    </td>
                                    <td>${country.name?.common || 'N/A'}</td>
                                    <td>${country.region || 'N/A'}</td>
                                    <td>${country.capital?.[0] || 'N/A'}</td>
                                    <td>${formatLanguages(country.languages)}</td>
                                    <td>${formatNumber(country.population)}</td>
                                    <td>${formatNumber(country.area)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            content.innerHTML = tableHTML;
        }

        // Sort data helper function
        function sortData(data, column, direction) {
            return [...data].sort((a, b) => {
                let aVal, bVal;

                switch (column) {
                    case 'name':
                        aVal = a.name?.common || '';
                        bVal = b.name?.common || '';
                        break;
                    case 'region':
                        aVal = a.region || '';
                        bVal = b.region || '';
                        break;
                    case 'capital':
                        aVal = a.capital?.[0] || '';
                        bVal = b.capital?.[0] || '';
                        break;
                    case 'languages':
                        aVal = formatLanguages(a.languages);
                        bVal = formatLanguages(b.languages);
                        break;
                    case 'population':
                        aVal = a.population || 0;
                        bVal = b.population || 0;
                        return direction === 'asc' ? aVal - bVal : bVal - aVal;
                    case 'area':
                        aVal = a.area || 0;
                        bVal = b.area || 0;
                        return direction === 'asc' ? aVal - bVal : bVal - aVal;
                    default:
                        return 0;
                }

                // String comparison
                const aStr = String(aVal);
                const bStr = String(bVal);
                if (direction === 'asc') {
                    return aStr.localeCompare(bStr);
                } else {
                    return bStr.localeCompare(aStr);
                }
            });
        }

        // Sort table by column
        function sortTable(column) {
            // Determine sort direction
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }

            // Sort the filtered data
            const sortedData = sortData(filteredData, column, currentSort.direction);

            // Update the display
            displayCountries(sortedData);
            updateSortIndicators();
        }

        // Update sort indicators in column headers
        function updateSortIndicators() {
            const headers = document.querySelectorAll('th.sortable');
            headers.forEach(header => {
                header.classList.remove('sort-asc', 'sort-desc');
            });

            const columnNames = ['name', 'region', 'capital', 'languages', 'population', 'area'];
            const currentIndex = columnNames.indexOf(currentSort.column);
            
            if (currentIndex !== -1) {
                const currentHeader = headers[currentIndex];
                if (currentSort.direction === 'asc') {
                    currentHeader.classList.add('sort-asc');
                } else {
                    currentHeader.classList.add('sort-desc');
                }
            }
        }

        // Update statistics
        function updateStats(countries) {
            const totalPopulation = countries.reduce((sum, country) => sum + (country.population || 0), 0);
            const totalArea = countries.reduce((sum, country) => sum + (country.area || 0), 0);
            
            document.getElementById('stats').innerHTML = `
                <strong>Total Countries:</strong> ${countries.length} | 
                <strong>Total Population:</strong> ${formatNumber(totalPopulation)} | 
                <strong>Total Area:</strong> ${formatNumber(Math.round(totalArea))} km¬≤
            `;
            document.getElementById('stats').style.display = 'block';
        }

        // Load countries on page load
        loadCountries();
    </script>
</body>
</html>
